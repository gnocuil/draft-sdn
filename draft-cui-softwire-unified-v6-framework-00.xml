<?xml version="1.0" encoding="US-ASCII"?>

<?rfc toc="yes"?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="6"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc autobreaks="no"?>
<?rfc subcompact="no"?>

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
    <!ENTITY rfc2119 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
    <!ENTITY rfc6146 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6146.xml">
    <!ENTITY rfc6241 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6241.xml">
    <!ENTITY rfc6333 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.6333.xml">
    <!ENTITY rfc7084 PUBLIC "" "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.7084.xml">
    
    <!ENTITY I-D.ietf-softwire-lw4over6 SYSTEM 'http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-softwire-lw4over6.xml'>
    <!ENTITY I-D.ietf-softwire-map SYSTEM 'http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-softwire-map.xml'>
]>

<rfc category="std" docName="draft-cui-softwire-unified-v6-framework-01" ipr="trust200902">
    
<front>
  
  <title abbrev="Unified v6 Transition Framework">Unified IPv6 Transition Framework With Flow-based Forwarding</title>

<!-- Author List -->
  <author fullname="Yong Cui" initials="Y." surname="Cui">
    <organization>Tsinghua University</organization>
    <address>
      <postal>
        <street/>
          <city>Beijing</city>
          <code>100084</code>
          <country>P.R.China</country>
      </postal>
      <phone>+86-10-6260-3059</phone>
      <email>yong@csnet1.cs.tsinghua.edu.cn</email>
    </address>
  </author>
  
  <author fullname="Yuchi Chen" initials="Y." surname="Chen">
    <organization>Tsinghua University</organization>   
    <address>
      <postal>
        <street/>
          <city>Beijing</city>
          <region></region>
          <code>100084</code>
          <country>P.R.China</country>
      </postal>
      <phone>+86-10-6278-5822</phone>
      <email>chenycmx@gmail.com</email>
    </address>
  </author>
      
  <date year="2014"/>

  <abstract>
    <t>This document describes a unified IPv6 transition framework.
      This framework makes use of the flow-based packet forwarding technology,
       which can simplify the implementation of both control plane and data plane operations of transition mechanisms.
       The purpose of this work is to provide an integrated and flexible framework to implement and deploy the most popular translation and tunneling mechanisms,
       such as MAP-E, Lightweight 4over6, DS-Lite, NAT64 etc.
       This framework can benefit the industry by reducing the cost of implementation,
       providing flexibility for deployment, and allowing transition mechanisms to coexist and cooperate in the common infrastructure.
    </t>     
  </abstract>
  
  <note title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119"></xref>.</t>
    </note>
  
</front>

<middle>
 <section anchor="Introduction" title="Introduction">
    <t>Currently several translation and tunneling mechanisms have been proposed,
      such as NAT64 <xref target="RFC6146"></xref>, DS-Lite <xref target="RFC6333"/>,
      Lightweight 4over6 <xref target="I-D.ietf-softwire-lw4over6"/> and MAP-E <xref target="I-D.ietf-softwire-map"/>.
      These mechanisms have been or being implemented by the industry.
      However, the suitable transition mechanisms may change along the ISP's transition period.
      It's complicated and a big cost to upgrade existing devices to support new mechanisms.
    </t>
    
    <t>This document describes a unified IPv6 transition framework.
      This framework adopts flow-based packet forwarding technology on transition devices,
      which can simplify the implementation of both control plane and data plane operations of transition mechanisms.
      The forwarding rules of transition devices are controlled by centrallized Controller and can be changed easily,
      thus this framework can cover all existing transition scenarios, e.g. IPv4 over IPv6 hub and spoke model that MAP-E or DS-Lite does.
      This framework can benefit the industry by reducing the cost of implementing and deploying transition mechanisms.
    </t>  
  
  </section>

  <section anchor="Terminology" title="Terminology">
    <t>This document uses the following terms:</t>
      
    <t><list style="hanging" hangIndent="25">
       <t hangText="Customer Premises Equipment Switch (CPE Switch):">A dual-stack L3 switch that performs the flow-based packet forwarding function.
          It can be the home gateway or BNG.
       </t>

       <t hangText="Border Relay Switch (BR Switch):">A dual-stack L3 switch that performs the flow-based packet forwarding function.
          It is on the boarder of the ISP network and IPv4/ IPv6 Internet.
       </t>
       
       <t hangText="Controller:">A centrallized manager that controls both CPE Switch and BR Switch.
          Controller can be a single device or a cluster of devices.
       </t>
          
       <t hangText="Flow-based Packet Forwarding:">A function that forwards packets according to the forwarding rules specified by a flow table.
          A typical forwarding rule includes a match field and a action set.
          The match field specifies a certain flow, which is a set of packets that share some common features (e.g. same source and destionation address).
          The action set specifies the actions that should act on the certain flow (e.g. forward, encapsulate, or IP translate).
       </t>
    </list></t>
  
  </section>
  
  <section anchor="Overview" title="Framework Overview">
    <t>The architecture of the proposed unified IPv6 transition framework is illustrated in Figure 1.
      The customer LAN connects the IPv6 ISP network through CPE Switch.
      The ISP Network accesses the Internet through BR Switch. All devices in the ISP Network are not required
      to be managed by the Controller, thus the operator only needs to upgrade the CPEs and BRs.
    </t> 
    
    <figure align="center">
    <artwork><![CDATA[                                                               
                            +---------------+
                      ______|  Controller   |______
                     |      |               |      |         
                     |      +---------------+      |            
                     |                             |
 ______________      v       _______________       v      ______________
|              | +--------+ |               | +--------+ |              |
| Customer LAN |_|  CPE   |_|      ISP      |_|   BR   |_|   Internet   |
|              | | Switch | |    Network    | | Switch | |              |
|              | +--------+ |               | +--------+ |______________|
|______________|            |_______________|
                           
    ]]></artwork>
    <postamble> Figure 1  Architecture Overview </postamble>
    </figure>
    
    <t>Both CPE Switch and BR Switch perform flow-based forwarding, and are managed by the Controller.
    	 Since CPE Switch can work as a gateway of the customer network, it also needs to support
    	 traditional CPE function, such as DHCPv4 server and be compatible with <xref target="RFC7084"/>.
    </t>
    
    <t>Controller is responsible for controlling the forwarding behavior of both CPE Switch and BR Switch.
      Controller can be an individual device or a cluster of devices.
      The Controller configures the forwarding rules in the flow tables maintained by the CPE Switch and BR Switch
      according to the packets passed from Switches.
    </t>
    
    <t>Controller communicates with Switch using protocols that is able to carry flow information and flow table configuration,
      such as Openflow <xref target="OpenFlow" />.
    </t>
    
  </section>
  
  <section anchor="Control" title="Control Plane Behavior">
    <t>The Controller configures both CPE Switch and BR Switch through flow configuration. The switches are configured or pre-installed with
      default forwarding policy that forwards all unknown flows to the controller. The controller then installs a forwarding rule for the
      specific flow into the switch. All remaining packets of the same flow are processed based on this rule and will not be forwarded to
      the Controller. The definition of a flow depends on the forwording policy. For example, in MAP-E or Lightweight 4over6 scenario, the
      BR Switch treats all traffic from the same sender as a single flow.
    </t>
    
    <t>Some transition mechanisms require provisioning parameters to CPE. For example, DS-Lite, MAP-E and Lightweight 4over6 use DHCPv6
     to provision IPv6 address of AFTR/BR to CPE. Lightweight 4over6 provision IPv6 address and ports to CPE. Since these parameters
     can be represented by flow forwarding rules, in this framework such DHCPv6 based provisioning is not required. Instead these softwire
     configuration are embeded into forwarding rules and provisioned to CPE Switch through flow configuration. The device configuration that
     flow-based configuration doesn't support is still required, such as DHCPv6 prefix delegation.
     </t>
    
  </section>
  
  <section anchor="Data" title="Data Plane Behavior">
    <t>When receiving an incoming packet that doesn't have a match in the flow table (the intial packet of a new flow),
      CPE Switch and BR Switch MUST forward the packet to Controller.
      Controller MUST determine how to proceed the flow (e.g. IP tunneling encapsluaton/decapuslutaion, IP translation, etc.),
      and interpret the process into a set of forwarding rule configurations.
      Controller then installs these configurations to CPE Swtich and BR Switch.
      When receiving the subsequent packets of the flow, CPE Switch and BR Switch will apply the same actions to them,
      according to the forwarding rules in the flow table.
    </t>
    
    <t>Both CPE Switch and BR Switch MUST support the IPv6 tunneling encapsulation/decapuslation function required in <xref target="RFC6333"></xref>,
      <xref target="I-D.ietf-softwire-lw4over6"></xref> and <xref target="I-D.ietf-softwire-map"></xref>. To support IPv4/IPv6 translation scenarios such as NAT64,
      the switch MUST support IPv4/IPv6 packet translation function. These functions can be implemented either as processing actions in flow forwarding rules,
      or as standalone modules and provide a virtual interface to the switch module.
    </t>
    
    <t>In MAP-E/Lightweight 4over6 CPE and DS-Lite AFTR, NAT44 is required. In this framework, NAT44 can be simply supported by flow-based forwarding rules.
       Since typical flow-based forwarding mechanism support procotol header modification, e.g. set-field action in OpenFlow,
       NAT44 can be implemented as modification of source/destination IPv4 addresseses and ports. In this case, the flows are identified by 5-tuples
       and the first packet of each flow is passed to the Controller. NAT44 can also be implemented as a standlone function into switches, in this case
       passing the first packet of each 5-tuple flow to controller is not needed.
    </t>
    
    <t>Since MAP-E/Lightweight 4over6 requires port-based IPv4 address sharing, there may be thousands of ports in the same IPv4 address
       allocated to the same CPE. To reduce the amount of forwarding rules in BR Switch,
       when BR Switch matching an incoming packet, it SHOULD support the port-set based matching as defined in
       in Section 5.1 of <xref target="I-D.ietf-softwire-map"/>.
    </t>
  </section>
  
  <section title="Example: MAP-E/Lightweight 4over6 mode">
    <t>This section discusses how to run MAP-E/Lightweight 4over6 mode in this framework. In this mode, The Customer LAN is an
    	 IPv4 or dual-stack network, and the ISP Network is an IPv6 network. Initially the CPE Switch is configured with IPv6 address
    	 through DHCPv6 Prefix Delegation and connects to the Controller. The CPE Switch passes all unknown packets to the Controller.
  	</t>
  	<t>The Controller manages the binding between IPv4 addresses and IPv6 addresses. When a new CPE Switch connects to the Controller,
  		 the Controller allocates a preserved or new IPv4 address and a port set for the CPE Switch, by install one or two (for bi-directory)
  		 forwarding rule(s) in BR Switch. In case that CPE's NAT44 stated is maintained in Controller, when received an unknown packet from
  		 CPE Switch, the Controller pick one port from the port set of the CPE Switch and installs the forwarding rule in the CPE Switch.
  		 Both forwarding rules in CPE Switch and BR Switch include IPv4-in-IPv6 tunneling encapsulation/decapuslation action.
    </t>
    <t>This framework supports mesh mode for Lightweight 4over6. In mesh mode, CPE Switch (CPE1) sends every initial packet of each 5-tuple flow
       to Controller, and the Controller determines if the destination IPv4 address and port correspond to another CPE (CPE2). If so,
       the destination IPv6 address of the encapsulation action for this flow is set to CPE2's IPv6 address instead of BR Switch's IPv6 address.
    </t>
  </section>
 
  <section anchor="Security" title="Security Considerations">
    <t>As Switch should always send unknown flows to Controller, the link between Switch and Controller might be vulnerable to a typical DoS attack,
      which is done by flooding new sessions and can exhaust all available resources of Switch and/or Controller.
      Some monitoring or filtering approaches should be used to prevent against such an attack.
      In addition, Controller can implement a policy that restricts the resource allocated to a Switch,
      or restricts the resource of Switch allocated to a flow.
    </t>
    
    <t>Further security consideration is TBD.</t>
    
  </section>
  <section anchor="IANA" title="IANA Considerations">
    <t>This document does not include an IANA request.</t>
  </section>
</middle>

<back>

  <references title="Normative References">
    &rfc2119;

      <reference anchor="OpenFlow" target="https://www.opennetworking.org/images/stories/downloads/sdn-resources/onf-specifications/openflow/openflow-spec-v1.4.0.pdf">
        <front>
          <title>OpenFlow Switch Specification 1.4.0</title>
          <author>
            <organization>Open Networking Foundation</organization>
          </author>
          <date />
        </front>
      </reference>
      
  </references>

  <references title="Informative References">
   &rfc7084;
   &rfc6146;
   &rfc6241;
   &rfc6333;  
    &I-D.ietf-softwire-lw4over6;
   &I-D.ietf-softwire-map;
  </references>

</back>
</rfc>
